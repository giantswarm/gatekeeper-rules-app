apiVersion: constraints.gatekeeper.sh/v1beta1
kind: ConstraintAllowedRegistries
metadata:
  name: allowed-registries-constraint
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    {{- if .Values.rules.allowedRegistries }}
    namespaces:
{{ required "Namespace must be defined" .Values.rules.allowedRegistries.namespaces | toYaml | indent 6}}
    {{- end }}
  parameters:
    registries:
{{ required "Registries must be defined" .Values.rules.allowedRegistries.registries | toYaml | indent 6}}